<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <title>RSVP</title>
    <style>
        h1 {
            font-size: 4em;
        }
        p {
            font-size: 1.5em;
        }
        #familyMembers {
            margin: 20px 0;
        }
        button {
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .search {
            padding: 20px;
        }
    </style>
</head>
<body>

<header>
    <a href="home.html">Home</a>
    <a href="rsvp.html">RSVP</a>
    <a href="registry.html">Registry</a>
    <a href="funds.html">Honeymoon Fund</a>
    <a href="faq.html">FAQs</a>
</header>

<main>
    <h1>RSVP</h1>
    <p class="main">Please fill out the form to RSVP to the wedding! The invitation included the names
        of those invited and whether or not plus ones were being accommodated! Thank you
        for understanding this is going to be a small wedding and not all can be invited!</p>
    <p class="deadline">The deadline to RSVP is April 20th.</p>

    <label for="search">Search for a family:</label>
    <input type="text" id="search" placeholder="Start typing a name...">
    
    <!-- Family dropdown -->
    <label for="familyDropdown">Select your family:</label>
    <select id="familyDropdown">
        <!-- Family names will be populated here dynamically -->
    </select>
    
    <!-- Family members checkboxes -->
    <div id="familyMembersContainer" class="checkbox-group">
        <!-- Checkboxes will appear here dynamically when a family is selected -->
    </div>

    <button id="submitBtn">Submit RSVP</button>
</main>

<script src="fade_script.js"></script>

<script>
    // Fetch family names from Google Apps Script or API
    fetch('https://script.google.com/macros/s/AKfycbzK46TFrZrVl3K_mG-9qjmRiZJN0uVuY2zv4QbU3vcD/dev')  // Replace with your actual Google Apps Script URL
        .then(response => response.json())
        .then(families => {
            // Store the families in a global variable for later use
            window.familiesData = families;
        })
        .catch(error => {
            console.error('Error fetching family data:', error);
        });

    // Event listener for the search input field
    document.getElementById('search').addEventListener('input', function(event) {
        const searchTerm = event.target.value.toLowerCase();  // Get the typed input, case insensitive
        const familyDropdown = document.getElementById('familyDropdown');
        familyDropdown.innerHTML = '';  // Clear existing options

        // Filter families based on the search term
        const filteredFamilies = window.familiesData.filter(family => {
            return family.members.some(name => name.toLowerCase().includes(searchTerm));
        });

        // Populate the dropdown with filtered families
        filteredFamilies.forEach(family => {
            const option = document.createElement('option');
            option.value = family.familyId;  // Use familyId or the full family name as value
            option.textContent = family.familyName;  // Display the family name
            familyDropdown.appendChild(option);
        });

        // If no match is found, show a message in the dropdown
        if (filteredFamilies.length === 0 && searchTerm) {
            const option = document.createElement('option');
            option.textContent = 'No families found';
            familyDropdown.appendChild(option);
        }
    });

    // Event listener for when a family is selected from the dropdown
    document.getElementById('familyDropdown').addEventListener('change', function(event) {
        const familyId = event.target.value;
        const selectedFamily = window.familiesData.find(family => family.familyId === familyId);

        // Clear previous checkboxes
        const familyMembersContainer = document.getElementById('familyMembersContainer');
        familyMembersContainer.innerHTML = '';  // Clear existing checkboxes

        // If a family is selected, generate checkboxes for the family members
        if (selectedFamily) {
            selectedFamily.members.forEach(member => {
                const checkboxContainer = document.createElement('div');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = member;  // Use the member's name as the checkbox ID
                checkbox.value = member;

                const label = document.createElement('label');
                label.setAttribute('for', member);
                label.textContent = member;

                checkboxContainer.appendChild(checkbox);
                checkboxContainer.appendChild(label);
                familyMembersContainer.appendChild(checkboxContainer);
            });
        }
    });

    // Event listener for the submit button
    document.getElementById('submitBtn').addEventListener('click', function() {
        const selectedMembers = [];
        const checkboxes = document.querySelectorAll('#familyMembersContainer input[type="checkbox"]:checked');
        
        checkboxes.forEach(checkbox => {
            selectedMembers.push(checkbox.value);  // Collect selected family members
        });

        if (selectedMembers.length > 0) {
            // Prepare the data to send (example: you can add other form data)
            const formData = {
                familyMembers: selectedMembers,
                // Add other fields like name, email, etc. here
            };

            // Send data to the Google Sheet or any backend of your choice (e.g., using Google Apps Script)
            fetch('https://script.google.com/macros/s/AKfycbzK46TFrZrVl3K_mG-9qjmRiZJN0uVuY2zv4QbU3vcD/dev', {  // Replace with your actual URL for Apps Script
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                alert('RSVP Submitted Successfully!');
            })
            .catch(error => {
                console.error('Error submitting RSVP:', error);
            });
        } else {
            alert('Please select at least one family member.');
        }
    });
</script>

</body>
</html>
