<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <title>RSVP</title>
    <style>
        h1 {
            font-size: 4em;
        }
        p {
            font-size: 1.5em;
        }
        #familyMembers {
            margin: 20px 0;
        }
        button {
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .search {
            padding: 20px;
        }
    </style>
</head>
<body>

<header>
    <a href="home.html">Home</a>
    <a href="rsvp.html">RSVP</a>
    <a href="registry.html">Registry</a>
    <a href="funds.html">Honeymoon Fund</a>
    <a href="faq.html">FAQs</a>
</header>

<main>
    <h1>RSVP</h1>
    <p class="main">Please fill out the form to RSVP to the wedding! The invitation included the names
        of those invited and whether or not plus ones were being accommodated! Thank you
        for understanding this is going to be a small wedding and not all can be invited!</p>
    <p class="deadline">The deadline to RSVP is April 20th.</p>

    <label for="search">Search for a family:</label>
    <input type="text" id="search" placeholder="Start typing a name...">
    
    <!-- Family dropdown -->
    <label for="familyDropdown">Select your family:</label>
    <select id="familyDropdown">
        <!-- Family names will be populated here dynamically -->
    </select>
    
    <!-- Family members checkboxes -->
    <div id="familyMembersContainer" class="checkbox-group">
        <!-- Checkboxes will appear here dynamically when a family is selected -->
    </div>

    <button id="submitBtn">Submit RSVP</button>
</main>

<script src="fade_script.js"></script>

<script>
     fetch('https://script.google.com/macros/s/AKfycby0jXnBXhsbEyH91le8ihSq4M4T5kBnTvYw4FKDn2_VhChdz8noFE61dJoFeORZ2-acWw/exec') // Replace with your actual URL
        .then(response => response.json())
        .then(families => {
            const familyMembersDiv = document.getElementById('familyMembers');
            
            families.forEach(family => {
                const familyLabel = document.createElement('p');
                familyLabel.textContent = `Family: ${family.familyId}`;
                familyMembersDiv.appendChild(familyLabel);

                family.members.forEach(member => {
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.name = 'attendees';
                    checkbox.value = member;
                    checkbox.id = member;

                    const label = document.createElement('label');
                    label.htmlFor = member;
                    label.textContent = member;

                    familyMembersDiv.appendChild(checkbox);
                    familyMembersDiv.appendChild(label);
                    familyMembersDiv.appendChild(document.createElement('br'));
                });
            });
        })
        .catch(error => {
            console.error('Error fetching families:', error);
        });

        // Handle the form submission
        document.getElementById('rsvpForm').addEventListener('submit', function(e) {
            e.preventDefault(); // Prevent default form submission

            const formData = new FormData(this);
            const formObject = {};
            formData.forEach((value, key) => {
                if (key === 'attendees') {
                    // Collect all selected attendees
                    formObject[key] = formObject[key] || [];
                    formObject[key].push(value);
                } else {
                    formObject[key] = value;
                }
            });

            const googleScriptUrl = 'https://script.google.com/macros/s/AKfycby0jXnBXhsbEyH91le8ihSq4M4T5kBnTvYw4FKDn2_VhChdz8noFE61dJoFeORZ2-acWw/exec'; // Replace with your deployed URL

            // Send the form data to Google Apps Script
            fetch(googleScriptUrl, {
                method: 'POST',
                body: new URLSearchParams(formObject)
            })
            .then(response => response.text())
            .then(data => {
                alert(data); // Show response from the Google Apps Script
                document.getElementById('rsvpForm').reset(); // Reset the form
            })
            .catch(error => {
                console.error('Error:', error);
                alert('There was an error submitting your RSVP.');
            });
        });
</script>

</body>
</html>
