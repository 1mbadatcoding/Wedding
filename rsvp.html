<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wedding RSVP</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #searchResults { margin-top: 20px; }
    .family { margin-bottom: 10px; }
    .member { margin-left: 20px; }
  </style>
</head>
<body>

<h1>RSVP for Our Wedding</h1>
<p>Search for your name to RSVP:</p>
<input type="text" id="searchInput" placeholder="Enter your name">
<button onclick="searchFamily()">Search</button>

<div id="searchResults"></div>

<script>
  // Replace this URL with your Google Apps Script Web App URL
  const scriptURL = "https://script.google.com/macros/s/AKfycby78ilE9ZFFuXMVIDx_lTTQPh3J2jFiJSVT8I90LoNcSoSLVFTb3arSgjI61ixGBsIBSA/exec"; // <-- Your Web App URL here

  function searchFamily() {
    const searchInput = document.getElementById('searchInput').value;

    // Send a GET request to your Google Apps Script Web App with the search input
    fetch(`${scriptURL}?name=${encodeURIComponent(searchInput)}`)
      .then(response => response.json())
      .then(data => displayResults(data))
      .catch(error => console.error("Error fetching family data:", error));
  }

  function displayResults(familyMembers) {
    const resultsDiv = document.getElementById('searchResults');
    resultsDiv.innerHTML = ''; // Clear previous results

    if (familyMembers.length === 0) {
      resultsDiv.innerHTML = 'No family members found.';
      return;
    }

    const familyDiv = document.createElement('div');
    familyDiv.classList.add('family');

    familyMembers.forEach(member => {
      const memberDiv = document.createElement('div');
      memberDiv.classList.add('member');

      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.value = member;

      const label = document.createElement('label');
      label.textContent = member;

      memberDiv.appendChild(checkbox);
      memberDiv.appendChild(label);
      familyDiv.appendChild(memberDiv);
    });

    const rsvpButton = document.createElement('button');
    rsvpButton.textContent = 'RSVP';
    rsvpButton.onclick = () => submitRSVP(familyMembers[0], getSelectedMembers(familyDiv)); // Use first member name as family name
    familyDiv.appendChild(rsvpButton);

    resultsDiv.appendChild(familyDiv);
  }

  function getSelectedMembers(familyDiv) {
    const checkboxes = familyDiv.querySelectorAll('input[type="checkbox"]');
    const selectedMembers = [];
    checkboxes.forEach(checkbox => {
      if (checkbox.checked) {
        selectedMembers.push(checkbox.value);
      }
    });
    return selectedMembers;
  }

  function submitRSVP(familyName, members) {
    // Prepare the data to send to the Google Apps Script Web App for RSVP submission
    const rsvpData = {
      familyName: familyName,
      members: members
    };

    // Send a POST request to the Google Apps Script Web App to record the RSVP
    fetch(scriptURL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(rsvpData)
    })
    .then(response => response.json())
    .then(data => {
      alert('Your RSVP has been submitted.');
    })
    .catch(error => {
      console.error("Error submitting RSVP:", error);
      alert('An error occurred. Please try again.');
    });
  }
</script>

</body>
</html>
